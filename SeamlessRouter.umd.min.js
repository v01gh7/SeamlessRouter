(function(b,T){typeof exports=="object"&&typeof module<"u"?T(exports):typeof define=="function"&&define.amd?define(["exports"],T):(b=typeof globalThis<"u"?globalThis:b||self,T(b.SeamlessRouter={}))})(this,(function(b){"use strict";let y={...{prefetch:{enabled:!0,mobileThreshold:768,desktopPrefetchAll:!0,mobilePrefetchLimit:3,navigationExtraPages:2,hoverDelay:300,touchDelay:100},cache:{enabled:!0,maxSizeMB:30,maxEntries:100,alwaysCache:["/","/index.html","/contacts.html","/about.html"],checkLastModified:!0,ttlHours:24},offline:{enabled:!0,showOfflineIndicator:!0,offlinePageUrl:"/offline.html",cacheMedia:!1},animations:{enabled:!0,defaultDuration:300,respectReducedMotion:!0,animationTypes:["fade","slide-left","slide-right","slide-up","slide-down","collapse","diagonal"],defaultType:"fade"},general:{debug:process.env.NODE_ENV==="development",dataNoRoutingAttribute:"data-no-routing"}}};function l(){return{...y}}function x(r){y={...y,...r,prefetch:{...y.prefetch,...r.prefetch},cache:{...y.cache,...r.cache},offline:{...y.offline,...r.offline},animations:{...y.animations,...r.animations},general:{...y.general,...r.general}}}function w(){return window.innerWidth<l().prefetch.mobileThreshold}function K(){const r=l();return r.prefetch.enabled?w()?r.prefetch.mobilePrefetchLimit:r.prefetch.desktopPrefetchAll?1/0:r.prefetch.mobilePrefetchLimit:0}class G{cache=new Map;stats={totalEntries:0,totalSize:0,hits:0,misses:0,hitRate:0};isSupported=!1;constructor(){this.checkSupport(),this.loadFromStorage()}checkSupport(){try{const e="__router_cache_test__";localStorage.setItem(e,"test"),localStorage.removeItem(e),this.isSupported=!0}catch{console.warn("‚ö†Ô∏è localStorage not supported, using memory cache only"),this.isSupported=!1}}loadFromStorage(){if(this.isSupported)try{const e=localStorage.getItem("router_cache");if(e){const t=JSON.parse(e);this.cache=new Map(t.cache||[]),this.stats=t.stats||this.stats,this.cleanupExpired(),l().general.debug&&console.log("üì¶ Cache loaded from storage:",this.stats)}}catch(e){console.error("‚ùå Error loading cache from storage:",e),this.clear()}}saveToStorage(){if(this.isSupported)try{const e={cache:Array.from(this.cache.entries()),stats:this.stats,timestamp:Date.now()};localStorage.setItem("router_cache",JSON.stringify(e))}catch(e){console.error("‚ùå Error saving cache to storage:",e)}}cleanupExpired(){const e=l(),t=Date.now(),i=e.cache.ttlHours*60*60*1e3;let n=0;for(const[a,s]of this.cache.entries())e.cache.alwaysCache.includes(a)||t-s.timestamp>i&&(this.cache.delete(a),this.stats.totalSize-=s.size,n++);this.stats.totalEntries=this.cache.size,n>0&&l().general.debug&&console.log(`üßπ Cleaned up ${n} expired cache entries`)}shouldUpdateEntry(e,t,i){const n=this.cache.get(e);return!!(!n||t&&n.lastModified!==t||i&&n.etag!==i)}calculateSize(e,t){let i=0;return i+=new Blob([e]).size,i+=JSON.stringify(t).length*2,i+=100,i}checkLimits(){const e=l(),t=e.cache.maxSizeMB*1024*1024,i=e.cache.maxEntries;for(;(this.stats.totalSize>t||this.cache.size>i)&&this.cache.size>0;){let n=null,a=Date.now();for(const[s,o]of this.cache.entries())e.cache.alwaysCache.includes(s)||o.timestamp<a&&(a=o.timestamp,n=s);if(n){const s=this.cache.get(n);this.cache.delete(n),this.stats.totalSize-=s.size,this.stats.totalEntries--,l().general.debug&&console.log(`üóëÔ∏è Removed old cache entry: ${n}`)}else break}}set(e,t,i={}){if(!l().cache.enabled)return!1;const n=l(),a=i["last-modified"],s=i.etag;if(!this.shouldUpdateEntry(e,a,s))return n.general.debug&&console.log(`‚ôªÔ∏è Cache entry not changed: ${e}`),!1;const o=this.cache.get(e);o&&(this.stats.totalSize-=o.size);const d=this.calculateSize(t,i),g={url:e,html:t,headers:i,timestamp:Date.now(),size:d,lastModified:a,etag:s};return this.cache.set(e,g),this.stats.totalSize+=d,this.stats.totalEntries=this.cache.size,this.checkLimits(),this.saveToStorage(),n.general.debug&&console.log(`üíæ Cache set: ${e} (${Math.round(d/1024)}KB)`),!0}get(e){if(!l().cache.enabled)return null;const t=this.cache.get(e);return t?(this.stats.hits++,this.updateHitRate(),l().general.debug&&console.log(`üéØ Cache hit: ${e}`),t):(this.stats.misses++,this.updateHitRate(),l().general.debug&&console.log(`‚ùå Cache miss: ${e}`),null)}has(e){return this.cache.has(e)}delete(e){const t=this.cache.get(e);return t?(this.cache.delete(e),this.stats.totalSize-=t.size,this.stats.totalEntries--,this.saveToStorage(),l().general.debug&&console.log(`üóëÔ∏è Cache deleted: ${e}`),!0):!1}clear(){const e=this.cache.size;this.cache.clear(),this.stats={totalEntries:0,totalSize:0,hits:0,misses:0,hitRate:0},this.isSupported&&localStorage.removeItem("router_cache"),l().general.debug&&console.log(`üßπ Cache cleared (${e} entries removed)`)}updateHitRate(){const e=this.stats.hits+this.stats.misses;this.stats.hitRate=e>0?this.stats.hits/e:0}getStats(){return{...this.stats}}getUrls(){return Array.from(this.cache.keys())}getSizeMB(){return Math.round(this.stats.totalSize/(1024*1024)*100)/100}isCacheSupported(){return this.isSupported}}class J{prefetchManager;navigationHistory=[];maxHistorySize=100;isEnabled=!0;constructor(e){this.prefetchManager=e,this.isEnabled=l().prefetch.enabled,this.loadNavigationHistory(),this.setupNavigationTracking()}loadNavigationHistory(){try{const e=localStorage.getItem("router_navigation_history");e&&(this.navigationHistory=JSON.parse(e))}catch(e){console.warn("Failed to load navigation history:",e),this.navigationHistory=[]}}saveNavigationHistory(){try{localStorage.setItem("router_navigation_history",JSON.stringify(this.navigationHistory))}catch(e){console.warn("Failed to save navigation history:",e)}}setupNavigationTracking(){if(!this.isEnabled)return;let e=window.location.pathname;const t=()=>{const a=window.location.pathname;a!==e&&(this.recordNavigation(e,a),e=a,this.prefetchBasedOnPatterns(a))};window.addEventListener("popstate",t);const i=history.pushState,n=history.replaceState;history.pushState=function(...a){i.apply(this,a),setTimeout(t,0)},history.replaceState=function(...a){n.apply(this,a),setTimeout(t,0)}}recordNavigation(e,t){const i=this.navigationHistory.find(n=>n.from===e&&n.to===t);i?(i.count++,i.timestamp=Date.now()):(this.navigationHistory.push({from:e,to:t,count:1,timestamp:Date.now()}),this.navigationHistory.length>this.maxHistorySize&&(this.navigationHistory.sort((n,a)=>a.timestamp-n.timestamp),this.navigationHistory=this.navigationHistory.slice(0,this.maxHistorySize))),this.saveNavigationHistory()}prefetchBasedOnPatterns(e){if(!this.isEnabled)return;const t=l(),i=w(),n=this.getLikelyNextPages(e);if(n.length===0)return;let a;i?a=t.prefetch.mobilePrefetchLimit:a=t.prefetch.desktopPrefetchAll?n.length:t.prefetch.mobilePrefetchLimit;const s=n.slice(0,a);s.forEach(o=>{this.prefetchManager.prefetch(o.url,"auto")}),t.general.debug&&s.length>0&&console.log(`üéØ Intelligent prefetch for ${e}:`,s.map(o=>o.url))}getLikelyNextPages(e){const t=this.navigationHistory.filter(n=>n.from===e);return t.length===0?[]:t.map(n=>{const a=n.count,s=Date.now()-n.timestamp,o=Math.max(0,1-s/(720*60*60*1e3)),d=a*(1+o);return{url:n.to,probability:d}}).sort((n,a)=>a.probability-n.probability)}prefetchTopLevelPages(){if(!this.isEnabled)return;const e=l(),t=w(),i=new Set;this.navigationHistory.forEach(o=>{i.add(o.from),i.add(o.to)}),e.cache.alwaysCache.forEach(o=>{i.add(o)});const n=Array.from(i);if(n.length===0)return;let a;t?a=Math.min(e.prefetch.mobilePrefetchLimit,n.length):a=e.prefetch.desktopPrefetchAll?n.length:e.prefetch.mobilePrefetchLimit;const s=n.slice(0,a);s.forEach(o=>{this.prefetchManager.prefetch(o,"low")}),e.general.debug&&s.length>0&&console.log("üè† Prefetching top-level pages:",s)}prefetchNavigationExtraPages(e=document.body){if(!this.isEnabled)return;const t=l(),i=t.prefetch.navigationExtraPages;if(i<=0)return;const n=e.querySelectorAll('a[href*="page"], a[href*="p="], a[rel="next"], a[rel="prev"]'),a=[];if(n.forEach(o=>{const d=o.getAttribute("href");if(d&&!(d.startsWith("#")||d.startsWith("mailto:")||d.startsWith("tel:")||d.includes("://")))try{const g=new URL(d,window.location.origin);g.origin===window.location.origin&&a.push(g.pathname+g.search+g.hash)}catch{}}),a.length===0)return;const s=a.slice(0,i);s.forEach(o=>{this.prefetchManager.prefetch(o,"auto")}),t.general.debug&&s.length>0&&console.log(`üìÑ Prefetching ${s.length} extra navigation pages`)}clearHistory(){this.navigationHistory=[],localStorage.removeItem("router_navigation_history"),l().general.debug&&console.log("üßπ Navigation history cleared")}getStats(){return{totalPatterns:this.navigationHistory.length,uniqueFromPages:new Set(this.navigationHistory.map(e=>e.from)).size,uniqueToPages:new Set(this.navigationHistory.map(e=>e.to)).size,totalTransitions:this.navigationHistory.reduce((e,t)=>e+t.count,0)}}setEnabled(e){this.isEnabled=e}}class V{cacheManager;intelligentPrefetch;queue=[];activeRequests=new Set;maxConcurrent=3;isEnabled=!0;constructor(e){this.cacheManager=e,this.intelligentPrefetch=new J(this),this.isEnabled=l().prefetch.enabled,this.maxConcurrent=w()?2:3}async prefetch(e,t="low"){if(!this.isEnabled||this.activeRequests.has(e)||this.cacheManager.has(e))return!1;const i={url:e,priority:t,timestamp:Date.now(),controller:new AbortController};return this.addToQueue(i),this.processQueue(),!0}addToQueue(e){const t=this.queue.findIndex(i=>this.getPriorityValue(i.priority)<this.getPriorityValue(e.priority));t===-1?this.queue.push(e):this.queue.splice(t,0,e)}getPriorityValue(e){switch(e){case"high":return 0;case"auto":return 1;case"low":return 2;default:return 2}}async processQueue(){for(;this.activeRequests.size<this.maxConcurrent&&this.queue.length>0;){const e=this.queue.shift();if(!e)break;await this.executePrefetch(e)}}async executePrefetch(e){this.activeRequests.add(e.url);try{const t=await fetch(e.url,{method:"GET",priority:e.priority,signal:e.controller?.signal});if(!t.ok)throw new Error(`HTTP ${t.status}`);const i=await t.text(),n={};t.headers.forEach((a,s)=>{n[s]=a}),this.cacheManager.set(e.url,i,n),l().general.debug&&console.log(`‚úÖ Prefetched: ${e.url} (${e.priority})`)}catch(t){t instanceof Error&&t.name!=="AbortError"&&console.warn(`‚ö†Ô∏è Prefetch failed for ${e.url}:`,t)}finally{this.activeRequests.delete(e.url),this.processQueue()}}cancelPrefetch(e){const t=this.queue.findIndex(i=>i.url===e);if(t!==-1)return this.queue[t].controller?.abort(),this.queue.splice(t,1),!0;if(this.activeRequests.has(e)){for(const i of this.queue)if(i.url===e&&i.controller)return i.controller.abort(),this.activeRequests.delete(e),!0}return!1}prefetchMultiple(e,t="low"){if(!this.isEnabled)return;const i=K();(i===1/0?e:e.slice(0,i)).forEach(a=>{this.prefetch(a,t)})}prefetchNavigationLinks(e=document.body){if(!this.isEnabled)return;const t=l(),i=this.extractNavigationLinks(e);if(i.length>0){const n=w()?"low":"auto";this.prefetchMultiple(i,n),t.general.debug&&console.log(`üîó Prefetching ${i.length} navigation links`)}this.intelligentPrefetch.prefetchTopLevelPages(),this.intelligentPrefetch.prefetchNavigationExtraPages(e)}extractNavigationLinks(e){const t=[],i=l(),n=e.querySelectorAll(`a[href]:not([${i.general.dataNoRoutingAttribute}])`);for(const a of n){const s=a.getAttribute("href");if(s&&!(s.startsWith("#")||s.startsWith("mailto:")||s.startsWith("tel:")||s.includes("://")))try{const o=new URL(s,window.location.origin);o.origin===window.location.origin&&t.push(o.pathname+o.search+o.hash)}catch{}}return t}clearQueue(){this.queue.forEach(e=>{e.controller?.abort()});for(const e of this.activeRequests)this.cancelPrefetch(e);this.queue=[],this.activeRequests.clear(),l().general.debug&&console.log("üßπ Prefetch queue cleared")}setEnabled(e){this.isEnabled=e,e||this.clearQueue()}getStats(){return{queueLength:this.queue.length,activeRequests:this.activeRequests.size,maxConcurrent:this.maxConcurrent,isEnabled:this.isEnabled,intelligentPrefetch:this.intelligentPrefetch.getStats()}}getIntelligentPrefetch(){return this.intelligentPrefetch}clearNavigationHistory(){this.intelligentPrefetch.clearHistory()}}class Z{isAnimating=!1;currentAnimation=null;prefersReducedMotion=!1;constructor(){if(this.checkReducedMotion(),window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion: reduce)");this.prefersReducedMotion=e.matches,e.addEventListener("change",t=>{this.prefersReducedMotion=t.matches})}}checkReducedMotion(){window.matchMedia&&(this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches)}shouldAnimate(e){const t=l();return!(!t.animations.enabled||t.animations.respectReducedMotion&&this.prefersReducedMotion)}async animatePageTransition(e,t,i,n={}){if(!this.shouldAnimate(n)){i.replaceChild(t,e),n.onComplete?.();return}this.isAnimating&&await this.cancelCurrentAnimation(),this.isAnimating=!0,n.onStart?.();const a=l(),s=n.type||"fade",o=n.duration||a.animations.defaultDuration,d=n.easing||"ease-in-out";try{await this.executeAnimation(e,t,i,s,o,d,n)}catch(g){console.error("Animation error:",g),i.replaceChild(t,e)}finally{this.isAnimating=!1}}async executeAnimation(e,t,i,n,a,s,o){this.prepareElements(e,t,n),i.appendChild(t);const d=this.getKeyframes(n,e,t),g=e.animate(d,{duration:a,easing:s,fill:"forwards"});this.currentAnimation=g;const A=this.getNewContentKeyframes(n),k=t.animate(A,{duration:a,easing:s,fill:"forwards"});await Promise.all([g.finished,k.finished]),this.finishTransition(e,t,i),o.onComplete?.(),this.currentAnimation=null}prepareElements(e,t,i){const n={position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden"};Object.assign(e.style,n),Object.assign(t.style,{...n,opacity:"0",visibility:"hidden"}),e.classList.add("router-animation-old"),t.classList.add("router-animation-new"),e.classList.add(`router-animation-${i}`),t.classList.add(`router-animation-${i}`)}getKeyframes(e,t,i){switch(e){case"fade":return[{opacity:1,visibility:"visible"},{opacity:0,visibility:"hidden"}];case"slide-left":return[{transform:"translateX(0)",opacity:1,visibility:"visible"},{transform:"translateX(-100%)",opacity:0,visibility:"hidden"}];case"slide-right":return[{transform:"translateX(0)",opacity:1,visibility:"visible"},{transform:"translateX(100%)",opacity:0,visibility:"hidden"}];case"slide-up":return[{transform:"translateY(0)",opacity:1,visibility:"visible"},{transform:"translateY(-100%)",opacity:0,visibility:"hidden"}];case"slide-down":return[{transform:"translateY(0)",opacity:1,visibility:"visible"},{transform:"translateY(100%)",opacity:0,visibility:"hidden"}];case"collapse":return[{transform:"scale(1)",opacity:1,visibility:"visible"},{transform:"scale(0.8)",opacity:0,visibility:"hidden"}];case"diagonal":return[{transform:"translate(0, 0) scale(1)",opacity:1,visibility:"visible"},{transform:"translate(100%, 100%) scale(0.8)",opacity:0,visibility:"hidden"}];default:return[{opacity:1,visibility:"visible"},{opacity:0,visibility:"hidden"}]}}getNewContentKeyframes(e){switch(e){case"fade":return[{opacity:0,visibility:"hidden"},{opacity:1,visibility:"visible"}];case"slide-left":return[{transform:"translateX(100%)",opacity:0,visibility:"hidden"},{transform:"translateX(0)",opacity:1,visibility:"visible"}];case"slide-right":return[{transform:"translateX(-100%)",opacity:0,visibility:"hidden"},{transform:"translateX(0)",opacity:1,visibility:"visible"}];case"slide-up":return[{transform:"translateY(100%)",opacity:0,visibility:"hidden"},{transform:"translateY(0)",opacity:1,visibility:"visible"}];case"slide-down":return[{transform:"translateY(-100%)",opacity:0,visibility:"hidden"},{transform:"translateY(0)",opacity:1,visibility:"visible"}];case"collapse":return[{transform:"scale(1.2)",opacity:0,visibility:"hidden"},{transform:"scale(1)",opacity:1,visibility:"visible"}];case"diagonal":return[{transform:"translate(-100%, -100%) scale(1.2)",opacity:0,visibility:"hidden"},{transform:"translate(0, 0) scale(1)",opacity:1,visibility:"visible"}];default:return[{opacity:0,visibility:"hidden"},{opacity:1,visibility:"visible"}]}}finishTransition(e,t,i){i.removeChild(e),t.style.cssText="",t.classList.remove("router-animation-new","router-animation-old"),Array.from(t.classList).filter(a=>a.startsWith("router-animation-")).forEach(a=>t.classList.remove(a))}async cancelCurrentAnimation(){this.currentAnimation&&(this.currentAnimation.cancel(),this.currentAnimation=null),this.isAnimating=!1}isAnimationInProgress(){return this.isAnimating}getAvailableAnimationTypes(){return l().animations.animationTypes}static createAnimationStyles(){return`
      /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ animations.css */
      .router-animation-old,
      .router-animation-new {
        will-change: transform, opacity;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
      }

      @media (prefers-reduced-motion: reduce) {
        .router-animation-old,
        .router-animation-new {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
    `}static loadAnimationStyles(){if(document.head.querySelector('link[href*="animations.css"]'))return;const e=document.createElement("link");e.rel="stylesheet",e.href="/animations.css",e.onload=()=>console.log("‚úÖ Animation styles loaded"),e.onerror=()=>console.warn("‚ö†Ô∏è Failed to load animation styles"),document.head.appendChild(e)}}class ee{isSupported=!1;registration=null;isEnabled=!0;constructor(){this.isSupported="serviceWorker"in navigator,this.isEnabled=l().offline.enabled}async register(){if(!this.isSupported||!this.isEnabled)return console.warn("‚ö†Ô∏è Service Worker not supported or disabled"),!1;try{return this.registration=await navigator.serviceWorker.register("/sw.js",{scope:"/"}),console.log("‚úÖ Service Worker registered:",this.registration),this.setupUpdateListeners(),this.setupNetworkMonitoring(),!0}catch(e){return console.error("‚ùå Service Worker registration failed:",e),!1}}setupUpdateListeners(){this.registration&&(this.registration.addEventListener("updatefound",()=>{const e=this.registration.installing;e&&e.addEventListener("statechange",()=>{e.state==="installed"&&(navigator.serviceWorker.controller?(console.log("üîÑ New Service Worker available"),this.showUpdateNotification()):console.log("‚úÖ Service Worker installed for the first time"))})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("üéÆ Service Worker controller changed")}))}showUpdateNotification(){console.log("üì¢ New version available. Refresh to update."),l().offline.showOfflineIndicator&&(this.showToast("New version available. Refreshing..."),setTimeout(()=>{window.location.reload()},3e3))}setupNetworkMonitoring(){if(!l().offline.showOfflineIndicator)return;const e=()=>{navigator.onLine?(this.hideOfflineIndicator(),console.log("üåê Online")):(this.showOfflineIndicator(),console.log("üì¥ Offline"))};window.addEventListener("online",e),window.addEventListener("offline",e),e()}showOfflineIndicator(){let e=document.getElementById("offline-indicator");e||(e=document.createElement("div"),e.id="offline-indicator",e.innerHTML=`
        <div style="
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          background: #f44336;
          color: white;
          text-align: center;
          padding: 10px;
          z-index: 9999;
          font-family: sans-serif;
          font-size: 14px;
        ">
          ‚ö†Ô∏è You are offline. Some features may be unavailable.
        </div>
      `,document.body.appendChild(e)),e.style.display="block"}hideOfflineIndicator(){const e=document.getElementById("offline-indicator");e&&(e.style.display="none")}showToast(e){const t=document.createElement("div");t.innerHTML=`
      <div style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #333;
        color: white;
        padding: 12px 20px;
        border-radius: 4px;
        z-index: 10000;
        font-family: sans-serif;
        font-size: 14px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      ">
        ${e}
      </div>
    `,document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},3e3)}async update(){if(!this.registration)return!1;try{return await this.registration.update(),console.log("üîÑ Service Worker update triggered"),!0}catch(e){return console.error("‚ùå Service Worker update failed:",e),!1}}async unregister(){if(!this.registration)return!1;try{const e=await this.registration.unregister();return console.log("üóëÔ∏è Service Worker unregistered:",e),this.registration=null,e}catch(e){return console.error("‚ùå Service Worker unregistration failed:",e),!1}}async clearCache(){if(!this.registration)return!1;try{const e=this.registration.active;e&&e.postMessage({type:"CLEAR_CACHE"});const t=await caches.keys();return await Promise.all(t.map(i=>caches.delete(i))),console.log("üßπ Service Worker cache cleared"),!0}catch(e){return console.error("‚ùå Failed to clear Service Worker cache:",e),!1}}async getCacheStats(){if(!this.registration)return null;try{const e=this.registration.active;if(!e)return null;const t=new MessageChannel;return new Promise((i,n)=>{t.port1.onmessage=a=>{a.data.error?n(a.data.error):i(a.data)},e.postMessage({type:"GET_CACHE_STATS"},[t.port2])})}catch(e){return console.error("‚ùå Failed to get cache stats:",e),null}}isServiceWorkerSupported(){return this.isSupported}isRegistered(){return!!this.registration}getRegistration(){return this.registration}setEnabled(e){this.isEnabled=e,!e&&this.registration?this.unregister():e&&!this.registration&&this.register()}}class te{events=new Map;on(e,t){return this.events.has(e)||this.events.set(e,[]),this.events.get(e).push(t),()=>{this.off(e,t)}}off(e,t){const i=this.events.get(e);if(!i)return;const n=i.indexOf(t);n!==-1&&i.splice(n,1),i.length===0&&this.events.delete(e)}emit(e,...t){const i=this.events.get(e);i&&i.forEach(n=>{try{n(...t)}catch(a){console.error(`Error in event handler for "${e}":`,a)}})}once(e,t){const i=(...n)=>{this.off(e,i),t(...n)};return this.on(e,i)}hasListeners(e){return this.events.has(e)&&this.events.get(e).length>0}removeAllListeners(e){e?this.events.delete(e):this.events.clear()}getEventNames(){return Array.from(this.events.keys())}}const I=r=>{console.warn("Fallback: redirecting via full page reload",r),window.location.href=r},E=["a","button[data-router-link]"],q=async r=>{try{const e=await fetch(r,{method:"GET"});return e.ok?e:(console.warn(`loadPage: HTTP ${e.status} –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ${r}`),null)}catch(e){return console.error("loadPage: –æ—à–∏–±–∫–∞ —Å–µ—Ç–∏ –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–∞",e),null}},C=new WeakMap,v={timeouts:[],intervals:[],listeners:[]},ie=EventTarget.prototype.addEventListener,ne=EventTarget.prototype.removeEventListener,re=window.setTimeout,ae=window.setInterval,se=()=>{window.setTimeout=function(n,a,...s){const o=re(n,a,...s);return v.timeouts.push(o),o},window.setInterval=function(n,a,...s){const o=ae(n,a,...s);return v.intervals.push(o),o},EventTarget.prototype.addEventListener=function(n,a,s){v.listeners.push({target:this,type:n,handler:a,options:s}),ie.call(this,n,a,s)},EventTarget.prototype.removeEventListener=function(n,a,s){v.listeners=v.listeners.filter(o=>!(o.target===this&&o.type===n&&o.handler===a)),ne.call(this,n,a,s)};const r=Element.prototype.appendChild,e=Element.prototype.prepend,t=Element.prototype.insertBefore,i=Element.prototype.replaceChild;Element.prototype.appendChild=function(n){return n instanceof HTMLScriptElement&&S(n),r.call(this,n)},Element.prototype.prepend=function(...n){for(const a of n)a instanceof HTMLScriptElement&&S(a);e.apply(this,n)},Element.prototype.insertBefore=function(n,a){return n instanceof HTMLScriptElement&&S(n),t.call(this,n,a)},Element.prototype.replaceChild=function(n,a){return n instanceof HTMLScriptElement&&S(n),i.call(this,n,a)},console.log("üß© Sandbox initialized")},S=r=>{const e={timeouts:[],intervals:[],listeners:[],classes:new Set,functions:new Set};C.set(r,e)},oe=r=>{const e=C.get(r);e&&(e.timeouts.forEach(clearTimeout),e.intervals.forEach(clearInterval),e.listeners.forEach(({target:t,type:i,handler:n,options:a})=>{t.removeEventListener(i,n,a)}),C.delete(r),console.log("üßπ Cleaned up script:",r))},ce=()=>{document.querySelectorAll("script").forEach(r=>{R(r)||(oe(r),r.remove())}),v.timeouts.forEach(clearTimeout),v.intervals.forEach(clearInterval),v.listeners.forEach(({target:r,type:e,handler:t,options:i})=>{r&&r.removeEventListener(e,t,i)}),console.log("‚úÖ Purged all dynamic scripts and listeners")},le=r=>{let e=5381,t=r.length;for(;t;)e=e*33^r.charCodeAt(--t);return(e>>>0).toString(36)},O=r=>new DOMParser().parseFromString(r,"text/html"),L=new Set,he=r=>{const e=r.getAttribute("src");if(e)return`src:${e}`;const t=r.textContent?.trim();return t?`code:${le(t.replace(/\s+/g," "))}`:null},de=r=>{L.delete(r)},ue=()=>{L.clear()},$=(r,e="head")=>{if(!r)return;const t=he(r);if(!t)return;const i=me(r);if(ge(r,t),L.has(t)&&!i)return;const n=D(r),a=e==="body"?document.body:document.head;S(n),a.appendChild(n),L.add(t)},fe=r=>{const e=Array.from(r.querySelectorAll("script")),t=[];for(const i of e){const n=D(i);t.push(n),r.removeChild(i)}return t},ge=(r,e)=>{if(e.startsWith("src:")){const t=r.getAttribute("src");if(!t)return;document.querySelectorAll(`script[src="${t}"]`).forEach(i=>i.remove())}else if(e.startsWith("code:")){const t=r.textContent?.trim()?.replace(/\s+/g," ");if(!t)return;document.querySelectorAll("script:not([src])").forEach(i=>{i.textContent?.trim()?.replace(/\s+/g," ")===t&&i.remove()})}de(e)},D=r=>{const e=document.createElement("script");for(const t of r.getAttributeNames()){const i=r.getAttribute(t);i!==null&&e.setAttribute(t,i)}if(!r.src){const t=r.textContent?.trim();t&&(e.textContent=t)}return e},R=r=>r.hasAttribute("data-keep"),F=r=>r.hasAttribute("data-skip"),me=r=>r.hasAttribute("data-reload"),_=r=>{const e=document.head,t=Array.from(r.children);for(const i of t){const n=i.tagName.toLowerCase();if(n==="title"){const a=e.querySelector("title");a&&a.remove(),e.appendChild(i.cloneNode(!0));continue}if(n==="script"){if(F(i))continue;$(i,"head");continue}B(i,e)||e.appendChild(i.cloneNode(!0))}for(const i of e.children)R(i)||B(i,r)||i.remove()},B=(r,e)=>{const t=r.tagName.toLowerCase();for(const i of e.children)if(i.tagName.toLowerCase()===t){if(t==="meta"){const n=r,a=i;if(n.getAttribute("name")&&a.getAttribute("name")===n.getAttribute("name")||n.getAttribute("property")&&a.getAttribute("property")===n.getAttribute("property"))return!0}if(t==="link"){const n=r,a=i;if(n.getAttribute("rel")===a.getAttribute("rel")&&n.getAttribute("href")===a.getAttribute("href"))return!0}}return!1},pe=r=>{const e=document.body,t=document.getElementById("avoid");e.innerHTML=r.innerHTML,t&&e.prepend(t)},H=r=>{ce(),ue();const e=fe(r);for(const t of e)F(t)||R(t)||$(t,"body")},N=async r=>{console.log("–ù–∞–≤–∏–≥–∞—Ü–∏—è –∫:",r),history.pushState({},"",r);const e=await q(r);if(!e){I(r);return}const t=await e.text(),i=O(t);_(i.head),pe(i.body),H(i.body)};window.addEventListener("popstate",()=>{N(window.location.pathname)});let m=null;function ye(r){m=r}const M=r=>{let e=null;if(r.tagName.toLowerCase()==="a"&&r.hasAttribute("href")){const t=r;if(t.target==="_blank")return null;e=t.getAttribute("href")}else r.tagName.toLowerCase()==="button"&&r.hasAttribute("data-router-link")&&(e=r.getAttribute("data-router-link"));if(!e)return null;try{const t=new URL(e,document.location.origin);return t.origin!==document.location.origin?null:t.pathname+t.search+t.hash}catch{return null}},P=r=>{const e=l();let t=r;for(;t;){if(t.hasAttribute(e.general.dataNoRoutingAttribute))return!0;t=t.parentElement}return!1},ve=r=>{const e=new WeakMap,t=new WeakMap,i=new WeakMap,n=l(),a=f=>{if(!m)return;const c=f.currentTarget,h=M(c);if(!h||P(c)||!n.prefetch.enabled)return;const u=window.setTimeout(()=>{m&&m.prefetch(h,"low")},n.prefetch.hoverDelay);i.set(c,u)},s=f=>{const c=f.currentTarget,h=i.get(c);if(h&&(window.clearTimeout(h),i.delete(c)),m){const u=M(c);u&&m.cancelPrefetch(u)}},o=f=>{if(!m)return;const c=f.currentTarget,h=M(c);if(!h||P(c)||!n.prefetch.enabled)return;const u=window.setTimeout(()=>{m&&m.prefetch(h,"auto")},n.prefetch.touchDelay);i.set(c,u)},d=f=>{const c=f.currentTarget,h=i.get(c);h&&(window.clearTimeout(h),i.delete(c))},g=f=>c=>{const h=c.currentTarget;if(P(h))return;const u=M(h);u&&(c.preventDefault(),c.stopPropagation(),f(u))},A=f=>{f.forEach(c=>{if(c instanceof HTMLElement&&M(c)&&!P(c)){const u=g(r);if(c.addEventListener("click",u),e.set(c,u),n.prefetch.enabled&&m){const p={mouseenter:a,mouseleave:s,touchstart:o,touchend:d,touchcancel:d};c.addEventListener("mouseenter",p.mouseenter),c.addEventListener("mouseleave",p.mouseleave),c.addEventListener("touchstart",p.touchstart),c.addEventListener("touchend",p.touchend),c.addEventListener("touchcancel",p.touchcancel),t.set(c,p)}}})},k=f=>{f.forEach(c=>{if(c instanceof HTMLElement){const h=e.get(c);h&&(c.removeEventListener("click",h),e.delete(c));const u=t.get(c);u&&(c.removeEventListener("mouseenter",u.mouseenter),c.removeEventListener("mouseleave",u.mouseleave),c.removeEventListener("touchstart",u.touchstart),c.removeEventListener("touchend",u.touchend),c.removeEventListener("touchcancel",u.touchcancel),t.delete(c));const p=i.get(c);p&&(window.clearTimeout(p),i.delete(c))}})},Me=document.querySelectorAll(E.join(", "));A(Me);const X=new MutationObserver(f=>{f.forEach(c=>{c.addedNodes.forEach(h=>{if(h instanceof HTMLElement){h.matches&&h.matches(E.join(", "))&&A([h]);const u=h.querySelectorAll?.(E.join(", "));u&&A(u)}}),c.removedNodes.forEach(h=>{if(h instanceof HTMLElement){h.matches&&h.matches(E.join(", "))&&k([h]);const u=h.querySelectorAll?.(E.join(", "));u&&k(u)}})})});return X.observe(document.body,{childList:!0,subtree:!0}),()=>{X.disconnect();const f=document.querySelectorAll(E.join(", "));k(f),document.querySelectorAll(E.join(", ")).forEach(h=>{if(h instanceof HTMLElement){const u=i.get(h);u&&(window.clearTimeout(u),i.delete(h))}})}};let z=null;function be(r){z=r}async function Ee(r,e){const t=document.body,i=document.body.parentElement,n=r.cloneNode(!0);z&&l().animations.enabled?await z.animatePageTransition(t,n,i,{type:e||"fade",duration:l().animations.defaultDuration,onComplete:()=>{U(r),H(n)}}):(i.replaceChild(n,t),U(r),H(n))}function U(r){const e=r.ownerDocument;e&&e.head&&_(e.head)}const we=async(r,e)=>{console.log("üé¨ –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –∫:",r,e?`(type: ${e})`:""),history.pushState({},"",r);const t=await q(r);if(!t){I(r);return}const i=await t.text(),n=O(i);await Ee(n.body,e)},Se=async(r,e={})=>{const t=l();let i=e.type;return i||(e.direction==="backward"?i=t.animations.animationTypes.includes("slide-right")?"slide-right":"fade":i=t.animations.animationTypes.includes("slide-left")?"slide-left":"fade"),we(r,i)};let j=0,W=!1;window.addEventListener("popstate",r=>{const e=Date.now();if(e-j<100||W)return;j=e,W=!0;const i=r.state?.direction||(history.length>1?"backward":"forward");Se(window.location.pathname,{direction:i}),setTimeout(()=>{W=!1},100)});class Q{cacheManager;prefetchManager;animationManager;serviceWorkerManager;eventEmitter;isInitialized=!1;detachRouteListeners=null;constructor(e){e&&x(e),this.cacheManager=new G,this.prefetchManager=new V(this.cacheManager),this.animationManager=new Z,this.serviceWorkerManager=new ee,this.eventEmitter=new te,this.injectAnimationStyles(),l().general.debug&&(console.log("üîß AdvancedRouter initialized with managers"),console.log("üìä Cache stats:",this.cacheManager.getStats()))}injectAnimationStyles(){if(this.loadAnimationStyles(),document.head.querySelector("#router-animation-styles"))return;const e=document.createElement("style");e.id="router-animation-styles",e.textContent=this.createAnimationStyles(),document.head.appendChild(e)}async init(){if(this.isInitialized){console.warn("‚ö†Ô∏è AdvancedRouter already initialized");return}l().offline.enabled&&await this.serviceWorkerManager.register(),this.attachEnhancedRouteListeners(),this.prefetchInitialLinks(),this.isInitialized=!0,this.eventEmitter.emit("init"),console.log("üöÄ AdvancedRouter initialized with all features")}attachEnhancedRouteListeners(){l();const e=t=>{this.navigateTo(t)};ye(this.prefetchManager),be(this.animationManager),this.detachRouteListeners=ve(e)}prefetchInitialLinks(){l().prefetch.enabled&&(setTimeout(()=>{this.prefetchManager.prefetchNavigationLinks()},1e3),window.addEventListener("load",()=>{setTimeout(()=>{this.prefetchManager.prefetchNavigationLinks()},500)}))}async navigateTo(e,t={}){if(!this.isInitialized){console.warn("‚ö†Ô∏è Router not initialized, using base navigation"),N(e);return}this.eventEmitter.emit("navigation:start",e,t);try{const i=this.cacheManager.get(e);i?await this.loadFromCache(e,i,t):await this.loadFromServer(e,t),this.eventEmitter.emit("navigation:complete",e,t),this.prefetchManager.prefetchNavigationLinks(document.body)}catch(i){console.error("‚ùå Navigation failed:",i),this.eventEmitter.emit("navigation:error",e,i,t),N(e),setTimeout(()=>{this.attachEnhancedRouteListeners()},100)}}async loadFromCache(e,t,i={}){l().general.debug&&console.log(`üéØ Loading from cache: ${e}`),this.eventEmitter.emit("cache:hit",e);const a=new DOMParser().parseFromString(t.html,"text/html");await this.updatePage(a,e,!0,i)}async loadFromServer(e,t={}){l().general.debug&&console.log(`üåê Loading from server: ${e}`),this.eventEmitter.emit("cache:miss",e);try{const i=await fetch(e,{method:"GET"});if(!i.ok)throw new Error(`HTTP ${i.status}`);const n=await i.text(),a={};i.headers.forEach((d,g)=>{a[g]=d}),this.cacheManager.set(e,n,a);const o=new DOMParser().parseFromString(n,"text/html");await this.updatePage(o,e,!1,t)}catch(i){throw i}}async updatePage(e,t,i,n={}){this.detachRouteListeners&&(this.detachRouteListeners(),this.detachRouteListeners=null),history.pushState({},"",t);const a=document.body,s=e.body.cloneNode(!0),o=document.body.parentElement,d=n.skipAnimation?void 0:n.animationType||"fade";if(!l().animations.enabled||n.skipAnimation||!d){o.replaceChild(s,a),this.updateHead(e.head),this.runScripts(s),this.attachEnhancedRouteListeners(),this.eventEmitter.emit("page:updated",t,i,{animated:!1});return}await this.animationManager.animatePageTransition(a,s,o,{type:d,duration:l().animations.defaultDuration,onComplete:()=>{this.updateHead(e.head),this.runScripts(s),this.attachEnhancedRouteListeners(),this.eventEmitter.emit("page:updated",t,i,{animated:!0,animationType:d})}})}updateHead(e){const t=document.head,i=e.querySelector("title"),n=t.querySelector("title");i&&n&&(n.textContent=i.textContent),["description","keywords","viewport"].forEach(s=>{const o=e.querySelector(`meta[name="${s}"]`),d=t.querySelector(`meta[name="${s}"]`);o&&d?d.setAttribute("content",o.getAttribute("content")||""):o&&!d&&t.appendChild(o.cloneNode(!0))})}runScripts(e){e.querySelectorAll("script").forEach(i=>{const n=document.createElement("script");Array.from(i.attributes).forEach(a=>{n.setAttribute(a.name,a.value)}),!i.src&&i.textContent&&(n.textContent=i.textContent),document.body.appendChild(n),i.remove()})}getCacheManager(){return this.cacheManager}getPrefetchManager(){return this.prefetchManager}getAnimationManager(){return this.animationManager}getServiceWorkerManager(){return this.serviceWorkerManager}on(e,t){return this.eventEmitter.on(e,t)}off(e,t){this.eventEmitter.off(e,t)}isRouterInitialized(){return this.isInitialized}clearCache(){this.cacheManager.clear(),this.eventEmitter.emit("cache:cleared")}clearPrefetchQueue(){this.prefetchManager.clearQueue(),this.eventEmitter.emit("prefetch:cleared")}clearNavigationHistory(){this.prefetchManager.clearNavigationHistory(),this.eventEmitter.emit("navigation:history:cleared")}getIntelligentPrefetchStats(){return this.prefetchManager.getIntelligentPrefetch().getStats()}setIntelligentPrefetchEnabled(e){this.prefetchManager.getIntelligentPrefetch().setEnabled(e),this.eventEmitter.emit("intelligent:prefetch:enabled",e)}setOfflineModeEnabled(e){this.serviceWorkerManager.setEnabled(e),this.eventEmitter.emit("offline:mode:enabled",e)}async updateServiceWorker(){const e=await this.serviceWorkerManager.update();return this.eventEmitter.emit("service:worker:updated",e),e}async clearServiceWorkerCache(){const e=await this.serviceWorkerManager.clearCache();return this.eventEmitter.emit("service:worker:cache:cleared",e),e}async getServiceWorkerCacheStats(){return await this.serviceWorkerManager.getCacheStats()}isOfflineModeSupported(){return this.serviceWorkerManager.isServiceWorkerSupported()}isOfflineModeEnabled(){return this.serviceWorkerManager.isRegistered()}setAnimationsEnabled(e){const t=l();x({animations:{...t.animations,enabled:e}}),this.eventEmitter.emit("animations:enabled",e)}setDefaultAnimationType(e){const t=l();t.animations.animationTypes.includes(e)?(x({animations:{...t.animations,defaultType:e}}),this.eventEmitter.emit("animation:type:changed",e)):console.warn(`‚ö†Ô∏è Animation type "${e}" is not available`)}getAvailableAnimationTypes(){return l().animations.animationTypes}navigateWithAnimation(e,t,i=!1){return this.navigateTo(e,{animationType:t,skipAnimation:i})}navigateWithoutAnimation(e){return this.navigateTo(e,{skipAnimation:!0})}areAnimationsEnabled(){return l().animations.enabled}isAnimationInProgress(){return this.animationManager.isAnimationInProgress()}async cancelCurrentAnimation(){await this.animationManager.cancelCurrentAnimation(),this.eventEmitter.emit("animation:cancelled")}loadAnimationStyles(){if(document.head.querySelector('link[href*="animations.css"]'))return;const e=document.createElement("link");e.rel="stylesheet",e.href="/animations.css",e.onload=()=>console.log("‚úÖ Animation styles loaded"),e.onerror=()=>console.warn("‚ö†Ô∏è Failed to load animation styles"),document.head.appendChild(e)}createAnimationStyles(){return`
      /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ animations.css */
      .router-animation-old,
      .router-animation-new {
        will-change: transform, opacity;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
      }

      @media (prefers-reduced-motion: reduce) {
        .router-animation-old,
        .router-animation-new {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }
    `}}const Y=new Q({general:{debug:process.env.NODE_ENV==="development",dataNoRoutingAttribute:"data-no-routing"}});se(),Y.init().then(()=>{console.log("‚úÖ AdvancedRouter fully initialized")}).catch(r=>{console.error("‚ùå Failed to initialize AdvancedRouter:",r)}),b.AdvancedRouter=Q,b.router=Y,Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})}));
